<div class="alert alert-dismissible alert-primary" *ngIf="!chosen_subrace">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  <h4 class="alert-heading">Retrieving data</h4>
  <p class="mb-0">Data is being retrieved</p>
</div>

<div class="card text-white bg-primary mb-3" style="max-width: 20rem;" *ngIf="chosen_subrace && !no_result">
  <div class="card-header">Subrace information</div>
  <div class="card-body">
    <h4 class="card-title">
      {{chosen_subrace.name}}
    </h4>
    {{chosen_subrace.long_desc}}<br/><br/>
    <b>Class:</b> {{chosen_subrace.race}}<br/>
    <b>Ability score increases:</b> {{chosen_subrace.asi}}<br/>
    <b>Attributes:</b>
    <div [innerHTML]="chosen_subrace.attributes"></div>
    <b>Source:</b> {{chosen_subrace.source}}<br/>
    <b>ID:</b> {{chosen_subrace.id}}
  </div>
</div>

<div *ngIf="no_result" class="card text-white bg-primary mb-3" style="max-width: 1200px">
  <div class="card-header">
    <h2 class="card-title">Create a new subrace</h2>
  </div>
  <div *ngIf="!discord.is_admin" class="card-body">
    Login to add a new subrace to the website
  </div>
  <div *ngIf="discord.is_admin" class="card-body">
    <form [formGroup]="creationForm">
      <!-- Name data -->
      <div class="row">
        <div class="col wlimit">
          Name:
        </div>
        <div class="col">

          <input type="text" formControlName="name" class="form-control" placeholder="Subrace name">
        </div>
      </div>

      <!-- Short description -->
      <div class="row">
        <div class="col wlimit">
          Short description:
        </div>
        <div class="col">
          <textarea type="text" formControlName="short_desc" class="form-control" rows="3"
                    placeholder="Short description"></textarea>
        </div>
      </div>

      <!-- Long description -->
      <div class="row">
        <div class="col wlimit">
          Long description:
        </div>
        <div class="col">
          <textarea type="text" formControlName="long_desc" class="form-control" rows="8"
                    placeholder="Long description"></textarea>
        </div>
      </div>

      <!-- Ability score increase -->
      <div class="row">
        <div class="col wlimit">
          Ability score increases:
        </div>
        <div class="col">
          <button type="button" (click)="addAsi()" class="btn btn-primary"
                  style="width: 100%; min-width: 200px">Add ASI
          </button>
        </div>
        <div class="col">
          <button type="button" (click)="removeAsi(asi_list.length-1)" class="btn btn-primary"
                  style="width: 100%; min-width: 200px">Remove last ASI
          </button>
        </div>
      </div>
      <div formArrayName="asi">
        <div *ngFor="let attr of asi_list.controls; let i = index" formArrayName="{{i}}">
          <div class="row">
            <div class="col wlimit">ASI {{i + 1}}</div>
            <div class="col">
              <select formControlName="name" class="custom-select">
                <option [value]="asi.id" *ngFor="let asi of ASI">{{asi.name}}</option>
              </select>
            </div>
            <div class="col">
              <input formControlName="value" type="text" class="form-control" placeholder="+1">
            </div>
          </div>
        </div>
      </div>

      <!-- Attributes -->
      <div class="row">
        <div class="col wlimit">
          Subclass attributes:
        </div>
        <div class="col">
          <button type="button" (click)="addAttribute()" class="btn btn-primary"
                  style="width: 100%; min-width: 200px">Add subclass attribute
          </button>
        </div>
        <div class="col">
          <button type="button" (click)="removeAttribute(attributes.length-1)" class="btn btn-primary"
                  style="width: 100%; min-width: 200px">Remove last subclass attribute
          </button>
        </div>
      </div>
      <div formArrayName="attributes">
        <div *ngFor="let attr of attributes.controls; let i = index" formArrayName="{{i}}">
          <div class="row">
            <div class="col wlimit">Attribute {{i + 1}} name:</div>
            <div class="col">
              <input formControlName="name" type="text" class="form-control" placeholder="Attribute name">
            </div>
          </div>
          <div class="row">
            <div class="col wlimit">Attribute {{i + 1}} description:</div>
            <div class="col">
              <textarea formControlName="desc" type="text" class="form-control" placeholder="Attribute description"
                        rows="2"></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Race -->
      <div class="row">
        <div class="col wlimit">
          Race:
        </div>
        <div class="col">
          <select formControlName="race" class="custom-select">
            <option [value]="r.id" *ngFor="let r of races">{{r.name}}</option>
          </select>
        </div>
      </div>

      <!-- Source -->
      <div class="row">
        <div class="col wlimit">
          Source:
        </div>
        <div class="col">
          <select formControlName="source" class="custom-select">
            <option [value]="s.id" *ngFor="let s of sources">{{s.name}}</option>
          </select>
        </div>
      </div>

      <!-- ID overwrite -->
      <div class="row">
        <div class="col wlimit">
          ID overwrite:
        </div>
        <div class="col">
          <input type="text" formControlName="id" class="form-control" placeholder="ID to overwrite">
        </div>
      </div>

      <!-- Save data button -->
      <div class="row">
        <button type="button" (click)="saveNewSublass()" class="btn btn-primary"
                style="width: 40%; margin: 10px 30% 0 30%;">
          Save changes
        </button>
      </div>

      <!-- Let the user know saving succeeded -->
      <div class="row">
        <div *ngIf="error===false" class="col alert alert-dismissible alert-success">
          Data successfully saved
        </div>
        <div *ngIf="error===true" class="col alert alert-dismissible alert-warning">
          Data saving failed
        </div>
      </div>
    </form>
  </div>
</div>
